---
title: "Proyecto 2 - Ubicaciones de Volcanes en Japón"
author: "Andrés Arguedas Leiva - Natalia Díaz Ramírez"
date: "11 Octubre 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,error = FALSE)
library(spatstat)
library(dplyr)
library(sp)
library(raster)
```

# Introducción

El objetivo del presente trabajo consiste en determinar si existen agrupaciones de volcanes en Japón.
Con base en el objetivo mencionado anteriormente, se pretende contestar las siguientes preguntas:

- ¿Los volcanes estan distribuidos aleatoriamente o existe evidencia de agrupaciones en la región de estudio?

- ¿Existe algún modelo para predecir la intensidad de volcanes en ciertas áreas de la región de estudio?

# Metodología

Los datos utilizados en este trabajo se obtuvieron del Global Volcanism Program (GVP) del Instituto Smithsoniano, los cuales hacen referencia a ubicaciones de volcanes que han estado activos en los últimos 10.000 años a nivel mundial. El GVP informa sobre las erupciones actuales de todo el mundo y mantiene un repositorio de bases de datos sobre volcanes activos y sus erupciones, además de ciertas variables de interés como su ubicación, año de la última erupción, tipo de volcán, comportamiento sísmico, entre otros. Para efectos de este trabajo, solamente se usaron las variables de la latitud y longitud en la cual está ubicado el volcán (para poder hacer una identificación del punto en el espacio). Además, se usaron los datos de la página GADM para obtener un mapa administrativo de Japón, para poder hacer gráficos sobre este. 

En términos del análisis, de la lista de todos los volcanes, se escogieron solamente aquellos que estuvieran en territorio de Japón, con el fin de hacer un análisis con resultados y conclusiones más precisas al tratarse de un área más reducida. Adicionalmente, por la historia geológica de Japón, en este país hay una gran cantidad de volcanes, por lo que, en términos de datos, se usaron los 128 volcanes de la serie de datos original que estuvieran cercanos al territorio japonés. Los datos se analizaron mediante métodos y modelos de procesos puntuales ya que, al tratarse de eventos geográficos en un solo punto, se pueden considerar como puntos en el espacio, además que se tiene la ubicación del volcán en latitud-longitud. Los datos fueron procesados mediante el software R, en la interfaz gráfica RStudio y se usaron las bibliotecas `spatstat`, para hacer los modelos de procesos puntuales, `dplyr`, para manipulación de datos y `sp`, para poder hacer algunos gráficos.

# Resultados

En este sección se presenta, primeramente, un análisis descriptivo de los datos mediante mapas con las ubicaciones de los volcanes y gráficos de intensidad. Posteriormente, se hace un análisis sobre la posible existencia de aglomeraciones de datos mediante las funciones L y K, usando varios ajustes por borde y simulaciones. Por último, se estiman dos modelos de procesos puntuales para intentar explicar la ubicación de los volcanes, haciendo pronósticos con base en estos y seleccionando al mejor.

```{r}
# Cargamos los datos
database <- read.csv("database.csv")
database2=database %>% filter(Country=="Japan"|Country=="Japan - administered by Russia")

# Especificamos la region
# database <- database[database$Region == "MÃ©xico and Central America", ]

# Definimos la ventana
wndw <- owin(x = c(min(database2$Longitude),max(database2$Longitude)),
             y = c(min(database2$Latitude), max(database2$Latitude)))

# Hacemos el objeto ppp

spec <- ppp(x = database2$Longitude, database2$Latitude, window = wndw)

# Cargamos el raster de elevacion y el shape file de Japon
elev <- raster(paste(getwd(), "/JPN_alt/JPN_alt.grd", sep = ""))
shp <- shapefile(paste(getwd(), "/JPN_adm/JPN_adm0.shp", sep = ""))

# Convertimos los puntos en un objeto 'sp' para poder graficarlos
lonlat <- cbind(database2$Longitude, database2$Latitude)
pts <- SpatialPoints(lonlat)

crdef <- CRS('+proj=longlat +datum=WGS84')

pts <- SpatialPoints(lonlat, proj4string = crdef)
```

Basandose en el gr?fico de patrones espaciales en el ?rea bajo estudio se puede observar que hay concentraciones en ciertas ?reas. As? mismo,en el gr?fico de densidad se sugiere la existencia de conglomerados de los volcanes de Jap?n que han hecho erupciones durante los ?ltimos 10000  a?os o que presentan actividad actualmente.

```{r}
plot(shp, main = "Grafico 1:\nUbicación de volcanes en Japón")
points(pts, col = 2, pch = 16, cex = 0.5)
```

```{r}
plot(density(spec),main="Gr?fico de densidad")
plot(shp, add = TRUE)
```

Para evaluar las propiedades de segundo orden se tom? en cuenta la funci?n k.


```{r}
rip.k <- Kest(spec)
plot(rip.k,main = "Funci?n k")
grid()
```


Seguidamente se usa la funci?n L, como correcion de la funci?n k.

```{r}
rip.l <- Lest(spec)
plot(rip.l,main = "Funci?n L")
grid()

```


Al comparar la funci?n te?rica con la emp?rica se puede observar que la distribuci?n espacial de los volcanes no se distribuye aleatoriamente.

```{r}
# Simulacion de Poissones

set.seed(1) # Establecemos una semilla para reproducibilidad
env <- envelope(spec, fun = Lest, nsim = 999)
plot(env,main = "Monte Carlo envelopes con funci?n L")
grid()
```

Al evaluar el comportamiento de la agrupaci?n de los volcanes respecto a la distancia. Se evidencia que a distancias cortas hay mayor agrupaci?n y como el crecimiento es r?pido se puede suponer que hay agrupaciones.

```{r}
# Cantidad de puntos cercanos segun aumenta el radio

l.iso <- rip.l$iso
l.theo <- rip.l$theo
l.dev <- l.iso - l.theo
plot(l.dev ~ rip.l$r, type = "l",
     ylab = "Desviacion distribuci?n teorica",
     xlab = "Distancia",
     main="Cercan?a de puntos seg?n distancia")
grid()

```

Se desea modelar la intensidad para lo cual se utiliz? un proceso de poisson no homogeneo (IPP) con una estimaci?n no param?trica usando kernels.

Ajustando el modelo de Poisson con intesidad log-lineal en las coordenadas cartesianas se obtuvo que no predice tan bien la intensidad.

**Modelo:**

lamda((x,y))=exp(-12.15 + 0.062 x + 0.059 y )


```{r}
# Modelo con solo x y y

fit1 <- ppm(spec, ~ x + y)
fit1
plot(fit1, how = "image", se = FALSE, pause = FALSE)
plot(p, add = T)
persp(predict(fit1), theta = 270)

```


Ahora, ajustando el modelo con una intensidad que es log-cuadratico en las coordenadas cartesianas se obtiene que la predicci?n de la intensidad mejora.

**Modelo:**

lamda((x,y))=exp(-369.09 + 6.21x - 3.63y - 0.026 x^2 + 0.032 xy - 0.01 y^2)


```{r}

# Modelo con un polinomio de grado 2 con x y y

fit2 <- ppm(spec, ~ polynom(x, y, 2))
fit2
plot(fit2, how = "image", se = FALSE, pause = FALSE)
plot(p, add = T)
persp(predict(fit2), theta = 180)
```


**Matriz de covariancia de los parametros del modelo log-cuadratico**

```{r}
as.data.frame(vcov(fit2))
```



**Comparar Modelos**

Al comparar el modelo log-cuadr?tico contra el modelo solo contiene el intercepto se obtuvo que el modelo con una intensidad que es log-cuadratico es el mejor.

```{r}
fitnull=update(fit2,~1)
anova(fitnull,fit2,test="Chi")
```



**conclusiones**

Se prob? que los volcanes con erupciones durante los ?ltimos 10,000 a?os o que muestran actividad actualmente en Jap?n no presentan una distribuci?n espacial aleatoria y se observa una tendencia de agrupaciones de dichos puntos. 

Adem?s, se model? la intensidad con un modelo log-cuadratico. 




**Referencias**

[](https://www.kaggle.com/smithsonian/volcanic-eruptions)





