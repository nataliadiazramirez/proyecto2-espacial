---
title: "Proyecto 2 - Ubicaciones de Volcanes del mundo"
author: "Andres Arguedas Leiva - Natalia Díaz Ramírez"
date: "11 Octubre 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,error = FALSE)
library(spatstat)
library(dplyr)
```



Los datos se obtuvieron de Global Volcanism Program (GVP) del Instituto Smithsoniano,los cuales hacen referencia a ubicaciones de los volcanes en Japón. El GVP informa sobre las erupciones actuales de todo el mundo y mantiene un repositorio de bases de datos sobre volcanes activos y sus erupciones. 

Los datos para el análisis incluye las ubicaciones de 128 volcanes de Japón con erupciones durante los últimos 10,000 años o que muestran actividad actualmente, tomando en cuenta la latitud y longitud.


El objetivo del presente escrito consiste en determinar si existen agrupaciones de los volcanes en Japón, para lo cual se pretende contestar las siguientes preguntas:

- Los eventos estan distribuidos aleatoriamente o existe evidencia de agrupaciones en la región de estudio?

- Existe algún modelo para predecir la intensidad?



Se desarrolló un analisis de procesos puntuales, ya que la ubicación de cada volcan representa las coordenadas del evento. Seguidamente se muestran los principales resultados:


```{r}
# Cargamos los datos
database <- read.csv("database.csv")
database2=database %>% filter(Country=="Japan"|Country=="Japan - administered by Russia")

# Especificamos la region
# database <- database[database$Region == "MÃƒÂ©xico and Central America", ]

# Definimos la ventana
wndw <- owin(x = c(min(database2$Longitude),max(database2$Longitude)),
             y = c(min(database2$Latitude), max(database2$Latitude)))

# Hacemos el objeto ppp

spec <- ppp(x = database2$Longitude, database2$Latitude, window = wndw)
```


Basandose en el gráfico de patrones espaciales en el área bajo estudio se puede observar que hay concentraciones en ciertas áreas. Así mismo,en el gráfico de densidad se sugiere la existencia de conglomerados de los volcanes de Japón que han hecho erupciones durante los últimos 10000  años o que presentan actividad actualmente.

```{r}
plot(spec,main = "Patrones espaciales")
```


 
```{r}
plot(density(spec),main="Gráfico de densidad")
```

Para evaluar las propiedades de segundo orden se tomó en cuenta la función k.


```{r}
rip.k <- Kest(spec)
plot(rip.k,main = "Función k")
grid()
```


Seguidamente se usa la función L, como correcion de la función k.

```{r}
rip.l <- Lest(spec)
plot(rip.l,main = "Función L")
grid()

```


Al comparar la función teórica con la empírica se puede observar que la distribución espacial de los volcanes no se distribuye aleatoriamente.

```{r}
# Simulacion de Poissones

set.seed(1) # Establecemos una semilla para reproducibilidad
env <- envelope(spec, fun = Lest, nsim = 999)
plot(env,main = "Monte Carlo envelopes con función L")
grid()
```

Al evaluar el comportamiento de la agrupación de los volcanes respecto a la distancia. Se evidencia que a distancias cortas hay mayor agrupación y como el crecimiento es rápido se puede suponer que hay agrupaciones.

```{r}
# Cantidad de puntos cercanos segun aumenta el radio

l.iso <- rip.l$iso
l.theo <- rip.l$theo
l.dev <- l.iso - l.theo
plot(l.dev ~ rip.l$r, type = "l",
     ylab = "Desviacion distribución teorica",
     xlab = "Distancia",
     main="Cercanía de puntos según distancia")
grid()

```

Se desea modelar la intensidad para lo cual se utilizó un proceso de poisson no homogeneo (IPP) con una estimación no paramétrica usando kernels.

Ajustando el modelo de Poisson con intesidad log-lineal en las coordenadas cartesianas se obtuvo que no predice tan bien la intensidad.

**Modelo:**

lamda((x,y))=exp(-12.15 + 0.062 x + 0.059 y )


```{r}
# Modelo con solo x y y

fit1 <- ppm(spec, ~ x + y)
fit1
plot(fit1, how = "image", se = FALSE, pause = FALSE)
persp(predict(fit1), theta = 270)

```


Ahora, ajustando el modelo con una intensidad que es log-cuadratico en las coordenadas cartesianas se obtiene que la predicción de la intensidad mejora.

**Modelo:**

lamda((x,y))=exp(-369.09 + 6.21x - 3.63y - 0.026 x^2 + 0.032 xy - 0.01 y^2)


```{r}

# Modelo con un polinomio de grado 2 con x y y

fit2 <- ppm(spec, ~ polynom(x, y, 2))
fit2
plot(fit2, how = "image", se = FALSE, pause = FALSE)
persp(predict(fit2), theta = 180)
```


**Matriz de covariancia de los parametros del modelo log-cuadratico**

```{r}
as.data.frame(vcov(fit2))
```



**Comparar Modelos**

Al comparar el modelo log-cuadrático contra el modelo solo contiene el intercepto se obtuvo que el modelo con una intensidad que es log-cuadratico es el mejor.

```{r}
fitnull=update(fit2,~1)
anova(fitnull,fit2,test="Chi")
```



**conclusiones**

Se probó que los volcanes con erupciones durante los últimos 10,000 años o que muestran actividad actualmente en Japón no presentan una distribución espacial aleatoria y se observa una tendencia de agrupaciones de dichos puntos. 

Además, se modeló la intensidad con un modelo log-cuadratico. 




**Referencias**

[](https://www.kaggle.com/smithsonian/volcanic-eruptions)





